# 硬件搭建与部署指南 — VEX V5 差速驱动机器人

**完整物料清单、逐步机械组装和部署说明**

> **本指南涵盖两种机器人配置：**
> - **ROBOT_2MOTOR** — 入门级，2个电机，2个轮子，绿色齿轮箱 (18:1)。推荐初学者使用。
> - **ROBOT_6MOTOR** — 进阶版，6个电机，6个轮子，蓝色齿轮箱 (6:1)。更快、更强、比赛就绪。
>
> 标有 **(6M)** 的数量仅适用于 6电机配置。部署前在 `config.h` 中选择一种配置。

---

## 目录

1. [物料清单 (BOM)](#1-物料清单-bom)
   - 1.1 [电子元件](#11-电子元件)
   - 1.2 [结构件 — C型铝材与横梁](#12-结构件--c型铝材与横梁)
   - 1.3 [传动系统 — 轮子、轴与齿轮](#13-传动系统--轮子轴与齿轮)
   - 1.4 [紧固件 — 螺丝与螺母](#14-紧固件--螺丝与螺母)
   - 1.5 [垫片与轴环](#15-垫片与轴环)
   - 1.6 [轴承](#16-轴承)
   - 1.7 [支撑轮](#17-支撑轮)
   - 1.8 [走线管理](#18-走线管理)
   - 1.9 [所需工具](#19-所需工具)
2. [底盘尺寸与布局](#2-底盘尺寸与布局)
3. [齿轮比与轴距计算](#3-齿轮比与轴距计算)
4. [组装 — 逐步说明](#4-组装--逐步说明)
   - 4.1 [第一步：搭建底盘框架](#41-第一步搭建底盘框架)
   - 4.2 [第二步：安装驱动轴与轮子](#42-第二步安装驱动轴与轮子)
   - 4.3 [第三步：安装电机与齿轮传动](#43-第三步安装电机与齿轮传动)
   - 4.4 [第四步：安装支撑轮](#44-第四步安装支撑轮)
   - 4.5 [第五步：安装主控与电池](#45-第五步安装主控与电池)
   - 4.6 [第六步：安装 IMU](#46-第六步安装-imu)
   - 4.7 [第七步：接线与走线](#47-第七步接线与走线)
5. [软件配置](#5-软件配置)
6. [部署到 VEX V5 主控](#6-部署到-vex-v5-主控)
7. [首次启动验证（6项检查）](#7-首次启动验证6项检查)
8. [故障排查](#8-故障排查)
9. [附录：零件编号速查表](#9-附录零件编号速查表)

---

## 1. 物料清单 (BOM)

### 1.1 电子元件

| # | 零件 | VEX 零件编号 | 数量 (2M) | 数量 (6M) | 备注 |
|---|------|-------------|----------|----------|------|
| 1 | V5 主控 (Brain) | 276-4810 | 1 | 1 | 主控制器 |
| 2 | V5 电池 | 276-4811 | 1 | 1 | 锂离子电池，使用前充电 >50% |
| 3 | V5 智能电机 (11W) | 276-4840 | 2 | 6 | **2M:** 绿色齿轮箱 (18:1, 200RPM)；**6M:** 蓝色齿轮箱 (6:1, 600RPM) |
| 4 | V5 惯性传感器 (IMU) | 276-4855 | 1 | 1 | 陀螺仪 + 加速度计 |
| 5 | V5 智能线缆 (300mm) | 276-4850 | 2 | 6 | 连接电机 |
| 6 | V5 智能线缆 (600mm) | 276-4851 | 1 | 1 | 连接 IMU（需要较长线缆） |
| 7 | V5 遥控器 | 276-4820 | 1 | 1 | 无线或 USB 接线模式 |
| 8 | V5 电池充电器 | 276-4812 | 1 | 1 | 比赛间隙充电 |
| 9 | USB-C 数据线 | — | 1 | 1 | 上传程序到主控 |

### 1.2 结构件 — C型铝材与横梁

所有 VEX V5 结构件使用 **12.7 mm (0.5英寸) 孔距**。
材质：0.040" 壁厚铝材（VEX 标准）。

| # | 零件 | 规格（孔数 × 截面） | 长度 (mm) | VEX 零件编号 | 数量 | 用途 |
|---|------|-------------------|----------|-------------|------|------|
| 1 | C型铝材 1×2×1×25 | 25孔，1×2×1截面 | 317.5 mm (12.5") | 276-2288 | 2 | 左右底盘侧梁（主框架） |
| 2 | C型铝材 1×2×1×15 | 15孔，1×2×1截面 | 190.5 mm (7.5") | 276-2286 | 2 | 前后横梁连接件 |
| 3 | C型铝材 1×5×1×25 | 25孔，1×5×1截面 | 317.5 mm (12.5") | 276-2294 | 1 | **（可选）** 宽中心梁，用于安装主控平台 |
| 4 | L型铝材（角铁）1×1×25 | 25孔 | 317.5 mm (12.5") | 276-2291 | 2 | **（可选）** 侧梁加固 |
| 5 | 角码（1×1，2孔） | 每侧2孔，90°弯折 | — | 276-1066 | 4 | 转角加固，提高框架刚性 |
| 6 | 平板（5×5） | 5×5孔 | 63.5×63.5 mm | 276-1050 | 1 | **（可选）** IMU / 传感器安装平台 |

> **截面命名说明：** "1×2×1" 表示 C 型铝的两侧翼缘各1孔高 (12.7mm)，底部2孔宽 (25.4mm) — 这是 VEX 标准 C 型截面。

> **最简构建：** 只需 **#1**（×2）和 **#2**（×2）即可搭建最简框架。**强烈建议**加上角码（#5）以增加刚性。其余均为可选。

### 1.3 传动系统 — 轮子、轴与齿轮

| # | 零件 | 规格 | VEX 零件编号 | 数量 (2M) | 数量 (6M) | 备注 |
|---|------|------|-------------|----------|----------|------|
| 1 | 4英寸全向轮 | 直径 101.6 mm | 276-3526 | 2 | — | **仅 2M** — 主驱动轮 |
| 1b | 3.25英寸全向轮 | 直径 82.55 mm | 276-3524 | — | 6 | **仅 6M** — 所有 6 个驱动轮 |
| 2 | 高强度 (HS) 轴 — 4" | 长度 101.6mm，1/4" 方孔 | 276-2293 | 2 | 6 | 驱动轴 |
| 3 | 高强度 (HS) 轴 — 2" | 长度 50.8mm，1/4" 方孔 | 276-2296 | 2 | — | **（方案A — 齿轮传动）** 电机中间轴 |
| 4 | 60齿高强度齿轮 | 模数0.8，HS孔 | 276-2169 | 2 | — | **（方案A — 齿轮传动）** 被动齿轮 |
| 5 | 36齿高强度齿轮 | 模数0.8，HS孔 | 276-2167 | 2 | — | **（方案A — 齿轮传动）** 主动齿轮 |
| 6 | HS 电机轴适配器 | 将电机输出适配到 HS 轴 | 276-8532 | 2 | 6 | 无论齿轮传动还是直驱都需要 |
| 7 | 标准轴 — 2" | 长度 50.8mm，标准 1/8" 方孔 | 276-2011 | 1 | — | **仅 2M** — 支撑轮轴（6M 使用 6 个驱动轮，无需支撑轮） |

**传动方案选择：**

| 方案 | 齿轮比 | 实际输出 | 所需轴 | 所需齿轮 |
|------|-------|---------|--------|---------|
| **A — 齿轮传动 60:36** | 内部 18:1 × 外部 60/36 = 30:1 | ~120 RPM，高扭矩 | 2×HS 4" + 2×HS 2" | 2×60T + 2×36T |
| **B — 直驱**（最简单） | 仅内部 18:1 | 200 RPM，中等扭矩 | 仅 2×HS 4" | 无 |

> **初次测试建议使用直驱** — 零件更少，组装更简单。如果需要更大推力，再改用齿轮传动。

### 1.4 紧固件 — 螺丝与螺母

VEX 全系列使用 **8-32 UNC** 螺纹标准。所有螺丝均为 T15 星形驱动。

| # | 零件 | 规格 | VEX 零件编号 | 数量 | 用途 |
|---|------|------|-------------|------|------|
| 1 | 星形螺丝 8-32 × 0.250" | 1/4" (6.35mm) 长 | 276-6690 | 30 | 通用：梁对梁、角码、IMU 安装 |
| 2 | 星形螺丝 8-32 × 0.375" | 3/8" (9.53mm) 长 | 276-6691 | 10 | 穿过单层垫片+梁壁 |
| 3 | 星形螺丝 8-32 × 0.500" | 1/2" (12.7mm) 长 | 276-6692 | 20 | 电机安装、穿过铜柱连接 |
| 4 | 星形螺丝 8-32 × 0.750" | 3/4" (19.05mm) 长 | 276-6694 | 8 | 穿过厚叠层 / 主控安装 |
| 5 | 星形螺丝 8-32 × 1.000" | 1" (25.4mm) 长 | 276-6696 | 4 | 穿过铜柱+梁壁（主控平台） |
| 6 | 锯齿螺母 (Keps) 8-32 | 带自锁垫圈 | 276-4796 | 40 | 快速组装（仅用于原型阶段） |
| 7 | 尼龙锁紧螺母 (Nylock) 8-32 | 尼龙嵌件锁紧 | 276-4800 | 30 | **比赛用** — 不会因振动松脱 |

**螺丝长度选择指南：**

| 场景 | 总叠层厚度 | 推荐螺丝 |
|------|-----------|---------|
| 梁对梁（两层壁） | 2 × 0.040" ≈ 2mm | 0.250" (1/4") |
| 梁 + 垫片 + 梁 | ~2mm + 垫片厚度 | 0.375" – 0.500" |
| 电机法兰对梁 | 电机体 + 壁 | 0.500" (1/2") |
| 穿过铜柱 + 梁壁 | 25.4mm + 壁 | 1.000" (1") |
| 角码 + 两层壁 | 3 × 0.040" | 0.250" (1/4") |

> **比赛规则提示：** 正式比赛机器人请**全部使用 Nylock 螺母**。Keps 螺母方便快拆但会在比赛中因振动松脱。

### 1.5 垫片与轴环

垫片用于填充轴上各组件之间的间隙。轴环用于锁定轴的位置。

| # | 零件 | 尺寸 | 孔径 | VEX 零件编号 | 数量 | 用途 |
|---|------|------|------|-------------|------|------|
| 1 | 特氟龙垫圈 / 薄垫片 | 1/16" (1.6mm) 厚 | 适配 1/8" 轴 | 276-1212 | 12 | 精细间距调整 |
| 2 | 尼龙垫片（小） | 1/8" (3.2mm) 厚 | 适配 1/8" 轴 | 276-1200 | 20 | 标准间隙填充 |
| 3 | 尼龙垫片（中） | 1/4" (6.35mm) 厚 | 适配 1/8" 轴 | 276-1201 | 10 | 较大间隙填充 |
| 4 | 尼龙垫片（大） | 3/8" (9.53mm) 厚 | 适配 1/8" 轴 | 276-1202 | 4 | 大间距（少用） |
| 5 | HS 垫片 | 1/8" (3.2mm) 厚 | 适配 HS 1/4" 轴 | 276-2312 | 12 | HS 驱动轴上的间隙填充 |
| 6 | HS 垫片 | 1/4" (6.35mm) 厚 | 适配 HS 1/4" 轴 | 276-2313 | 8 | HS 驱动轴上的较大间隙 |
| 7 | 标准轴环 | 固定螺丝锁紧 | 适配 1/8" 轴 | 276-2010 | 4 | 锁定标准轴（支撑轮） |
| 8 | HS 锁紧轴环 | 固定螺丝锁紧 | 适配 HS 1/4" 轴 | 276-2308 | 4 | 锁定 HS 驱动轴 |
| 9 | 橡胶轴环 | 摩擦配合 | 适配 1/8" 轴 | 276-1204 | 4 | 软限位 / 线缆固定（可选） |

**驱动轴上的垫片叠放顺序（齿轮传动方案）：**

```
外侧                                                          内侧
  ◄────────────────── HS 4" 轴 ──────────────────►

  [轴环] [轮子] | 壁 | [轴承] [1/8" HS垫片] [60T齿轮] [1/8" HS垫片] [轴承] | 壁 | [轴环]
                ▲                                                             ▲
          外侧 C 型壁                                                    内侧 C 型壁
```

**驱动轴上的垫片叠放顺序（直驱方案）：**

```
外侧                                                          内侧
  ◄────────────────── HS 4" 轴 ──────────────────►

  [轴环] [轮子] | 壁 | [轴承] [垫片填充间隙] [轴承] | 壁 | [电机适配器]
```

### 1.6 轴承

轴承让轴在金属孔中自由旋转，减少摩擦和晃动。

| # | 零件 | 类型 | VEX 零件编号 | 数量 | 用途 |
|---|------|------|-------------|------|------|
| 1 | HS 平面轴承 | 压入梁孔，HS 孔径 | 276-2310 | 4 | 支撑 HS 驱动轴（每根轴2个） |
| 2 | 标准平面轴承 | 压入梁孔，标准孔径 | 276-1209 | 2 | 支撑支撑轮的标准轴 |
| 3 | HS 枕块轴承 | 螺栓固定在表面，HS 孔径 | 276-2316 | 2 | **（可选）** 底盘端部的额外轴支撑 |

> **务必使用轴承。** 金属轴直接在铝材孔中旋转会磨损孔壁并产生晃动。每个轴穿过的孔都应该压入轴承。

### 1.7 支撑轮

机器人需要第三个接地点以保持稳定（2个驱动轮 + 1个被动支撑轮）。

| # | 零件 | 规格 | VEX 零件编号 | 数量 | 备注 |
|---|------|------|-------------|------|------|
| 1 | 2.75英寸全向轮 | 直径 69.85mm | 276-3525 | 1 | 自由旋转的后方支撑，允许转弯时侧滑 |
| 2 | 标准轴 — 2" | 长度 50.8mm，1/8" 方孔 | 276-2011 | 1 | 支撑轮轴 |
| 3 | 标准轴环 | 固定螺丝锁紧 | 276-2010 | 2 | 锁定支撑轴 |
| 4 | 标准平面轴承 | 标准孔径 | 276-1209 | 2 | 在横梁中支撑轴 |
| 5 | 尼龙垫片 1/8" | 标准孔径 | 276-1200 | 2 | 使轮子在轴上居中 |

> **三轮布局：** 两个大驱动轮靠近后方，一个小全向轮在前方中心（或反过来）。全向轮的滚轮设计允许原地转弯时自由侧滑。

### 1.8 走线管理

| # | 零件 | VEX 零件编号 | 数量 | 用途 |
|---|------|-------------|------|------|
| 1 | 扎带（小号，4"） | — | 15 | 每 50-80mm 将线缆固定在底盘上 |
| 2 | 粘贴式理线夹 | — | 4 | （可选）沿梁引导线缆 |
| 3 | 橡皮筋（#32 或 #64） | 276-1070 | 5 | 临时线缆束缚，也可用于机构 |

### 1.9 所需工具

| 工具 | 规格 | 用途 |
|------|------|------|
| VEX 星形螺丝刀 (T15 Torx) | — | 所有 8-32 星形螺丝 |
| 5/64" 六角扳手 | — | 标准轴环的固定螺丝 |
| 3/32" 六角扳手 | — | HS 轴环的固定螺丝 |
| 7/16" 梅花/开口扳手 | — | 拧紧螺丝时固定螺母 |
| 尖嘴钳 | — | 够到狭窄空间、夹持螺母 |
| 游标卡尺（推荐数显） | 0-150mm | **关键：** 测量轮径和轮距 |
| 直尺 / 卷尺 | 公制 + 英制 | 一般长度测量 |
| 剪线钳 / 斜口钳 | — | 剪扎带 |
| 美工刀 | — | （可选）清理铝材毛刺 |

---

## 2. 底盘尺寸与布局

### 俯视图

```
       ◄────── ~190mm (15孔) ──────►
   ┌═══════════════════════════════════════┐  ──┬
   ║  ● ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─  ● ║    │
   ║  │     前横梁 (15孔)               │  ║    │
   ║  ●                                 ●  ║    │
   ║  │     ┌─────────────────────┐     │  ║    │
   ║  │     │      V5 主控        │     │  ║    │
   ║  │     │   （铜柱垫高）       │     │  ║    │
   ║  │     └─────────────────────┘     │  ║    │
   ║  │                                 │  ║    │  ~317mm
   ║  │           ■ IMU（水平）         │  ║    │  (25孔)
   ║  │                                 │  ║    │
   ║  │     ┌────────┐  ┌────────┐      │  ║    │
   ║  │     │ 左电机  │  │ 右电机  │      │  ║    │
   ║  │     │        │  │        │      │  ║    │
   ║  │     └───┬────┘  └────┬───┘      │  ║    │
   ║  │         │ 齿轮啮合  │           │  ║    │
   ║  ● ─ ─ ─ ─┼ ─ ─ ─ ─ ─┼─ ─ ─ ─   ●  ║    │
   ║  │     后横梁          │           │  ║    │
   ║  ● ───────┼────────────┼──────────●   ║    │
   ╠══════════ ╪════════════╪══════════════╣  ──┘
     ▓▓▓▓▓  ──┤            ├──  ▓▓▓▓▓
   左轮      驱动轴              右轮
   (4" 全向轮)                  (4" 全向轮)

左侧 25孔              ◯              右侧 25孔
C型铝材 ═══         支撑轮            C型铝材 ═══
                  (2.75" 全向轮)
```

### 侧视图

```
                 ┌─────────────┐
                 │   V5 主控    │     ← 屏幕朝上
                 └──┬──────┬───┘
                    │      │         ← 1" 铜柱
   ─────────────────┴──────┴──────── ← 底盘框架（C型铝材）
   │ 电池（底部或后方）              │
   ──────────────────────────────────
   ▓▓▓▓  驱动轮  ▓▓▓▓          ◯  ← 支撑轮
```

### `config.h` 关键测量值

| 测量项 | 测量方法 | 2电机值 | 6电机值 | 配置常量 |
|--------|---------|---------|---------|----------|
| **轮子直径** | 用游标卡尺测量橡胶胎面外缘到外缘，穿过圆心 | 101.6mm → 0.1016m | 82.55mm → 0.08255m | `WHEEL_DIAMETER` |
| **轮距** | 左轮胎接地面中心 → 右轮胎接地面中心 | ~381mm → 0.381m | ~330mm → 0.330m | `WHEEL_TRACK` |
| **每转脉冲数** | 取决于齿轮箱和传动比 | 360（绿色直驱） | 300（蓝色直驱） | `TICKS_PER_REV` |

> **重要：** `WHEEL_TRACK` **不是** 底盘外部宽度！它是左右轮胎接地点中心之间的距离。请用游标卡尺或直尺仔细测量！

---

## 3. 齿轮比与轴距计算

### 电机齿轮箱参数

| 齿轮箱颜色 | 内部齿轮比 | 空载转速 | 堵转扭矩 | 每转脉冲数 |
|-----------|-----------|---------|---------|-----------|
| **绿色**（默认） | 18:1 | 200 RPM | 1.05 N·m | 360 |
| 红色 | 36:1 | 100 RPM | 2.1 N·m | 900 |
| 蓝色 | 6:1 | 600 RPM | 0.35 N·m | 1800 |

### 外部齿轮比（方案A）

```
主动齿轮（电机端）：36齿
被动齿轮（轮轴端）：60齿

外部齿轮比 = 60 / 36 = 1.667 : 1

结合绿色齿轮箱（18:1）：
  总齿轮比    = 18 × 1.667 = 30 : 1
  轮子转速    = 200 / 1.667 ≈ 120 RPM
  轮子扭矩    = 1.05 × 1.667 ≈ 1.75 N·m

TICKS_PER_REV = 360 × (60 / 36) = 600
```

### 中心距（轴距）计算

两个齿轮啮合时，其轴心之间的距离必须精确匹配：

```
轴距 = 模数 × (齿数₁ + 齿数₂) / 2

VEX 齿轮模数为 0.8：
  轴距(36T + 60T) = 0.8 × (36 + 60) / 2 = 0.8 × 48 = 38.4 mm

38.4 mm ÷ 12.7 mm/孔 = 3.024 孔 ≈ 3 孔距离
```

> **实际操作：** 将电机安装在距离驱动轴中心 3 孔的位置。0.3mm 的微小差异由齿轮间隙（backlash）自然吸收 — 这是正常的。如果齿轮太紧（打齿），可以使用长条孔微调到半孔位置。

### 常见 VEX 齿轮组合与轴距

| 主动齿轮 | 被动齿轮 | 齿轮比 | 理想轴距 (mm) | 孔距 |
|---------|---------|-------|------------:|-----:|
| 12T | 60T | 5:1 | 28.8 | 2.27 → 2孔 + 垫片 |
| 12T | 84T | 7:1 | 38.4 | 3 孔 |
| 36T | 60T | 1.67:1 | 38.4 | **3 孔** ← 本方案 |
| 36T | 84T | 2.33:1 | 48.0 | 3.78 → 4 孔 |
| 60T | 84T | 1.4:1 | 57.6 | 4.54 → 4.5 孔 |

---

## 4. 组装 — 逐步说明

### 4.1 第一步：搭建底盘框架

**目标：** 用两根侧梁和两根横梁组成矩形框架。

**本步骤所需零件：**
- 2× C型铝材 1×2×1×25（侧梁）
- 2× C型铝材 1×2×1×15（横梁）
- 4× 角码 1×1
- 16× 螺丝 8-32 × 0.250"
- 16× Nylock 螺母 8-32

**操作步骤：**

1. 将两根 **25孔 C型铝材** 平行放在平坦表面上，开口面**朝内**，间距约 190mm（由横梁确定）
2. 将两根 **15孔 C型铝材** 垂直放置在侧梁的前端（第1-2孔）和后端（第24-25孔）
3. 每个角用 **2颗螺丝 + 2个 Nylock 螺母** 穿过重叠的孔固定
4. 在每个角放置一个**角码**，用 **1颗螺丝 + 1个 Nylock 螺母** 穿过每个角码臂固定（额外 8 个紧固件）

```
   螺丝位置（俯视图）：         ● = 穿过梁连接处的螺丝
   ● ● ─────────────────── ● ●
   │                         │   ← 15孔横梁
   ▼                         ▼
   25孔侧梁                  25孔侧梁
   │                         │
   │       （空间用于         │
   │        安装电机          │
   │        和轴）            │
   │                         │
   ▲                         ▲
   │                         │   ← 15孔横梁
   ● ● ─────────────────── ● ●
```

**质量检查：**
- 框架平放在桌面上不会晃动（四角共面）
- 侧梁平行（测量前后间距 — 应相等）
- 转角接近 90°（测量对角线 — 应相等）
- 所有螺丝拧紧但不要过度（过度拧紧会滑丝）

### 4.2 第二步：安装驱动轴与轮子

**目标：** 两根高强度轴穿过底盘后部，安装 4 英寸全向轮。

**本步骤所需零件：**
- 2× HS 轴 4"
- 2× 4" 全向轮
- 4× HS 平面轴承
- 4× HS 锁紧轴环
- ~8× HS 垫片 (1/8") 用于居中

**操作步骤：**

1. **选择轴位置：** 25孔侧梁的第 21-23 孔（靠近后方）。两侧必须使用相同的孔位！
2. **将 HS 平面轴承压入** C型铝材两壁的孔中（共 4 个轴承 — 每根侧梁的内壁和外壁各 2 个）
3. 从外侧滑入 **HS 4" 轴**：

   ```
   由外至内顺序（单侧）：
   [HS 轴环] → [4"全向轮] → | 外壁+轴承 | → [HS垫片] → | 内壁+轴承 | → [HS 轴环]
   ```

4. 将 **4" 全向轮** 安装到每根轴的外端 — 将方轴压入轮子的方孔中
5. 在内外壁之间添加 HS 垫片**消除间隙** — 轴不应有横向窜动
6. 在每侧 C型铝材壁的两侧用 **HS 轴环** 锁定轴的位置

**质量检查：**
- 轴旋转自如无卡滞（拨动轮子 — 应能自转 3 秒以上）
- 无横向间隙（轴不会前后窜动）
- 轮子与轴垂直（无偏摆）
- 两个轮子高度相同（机器人在两个驱动轮上水平）

### 4.3 第三步：安装电机与齿轮传动

**目标：** 每个电机连接到对应的驱动轴。

#### 方案 A — 齿轮传动 (60:36)

**额外零件：**
- 2× HS 轴 2"（电机中间轴）
- 2× 36T HS 齿轮
- 2× 60T HS 齿轮
- 2× HS 电机轴适配器
- 2× HS 平面轴承（用于中间轴）
- 4× 螺丝 8-32 × 0.500"（电机安装）

**操作步骤：**

1. 将 **60T 齿轮** 安装在每根驱动轴上（已在底盘中的 HS 4" 轴），位于内侧轴承之间。位置距驱动轴中心 **3 孔**。
2. 将 **HS 电机轴适配器** 插入每个电机的输出端
3. 将 **36T 齿轮** 安装到电机轴适配器上
4. 用 **2 颗 0.500" 螺丝** 将每个电机固定在 C型铝材侧梁的**内侧**：
   - 电机上的 36T 齿轮必须与驱动轴上的 60T 齿轮啮合
   - 电机轴中心距驱动轴中心 **3 孔**（38.4mm 轴距）
5. 调整电机位置使齿轮平顺啮合 — 齿面之间留**微小间隙**（半个齿厚）比齿轮卡死更好

#### 方案 B — 直驱（最简单）

**额外零件：**
- 2× HS 电机轴适配器
- 4× 螺丝 8-32 × 0.500"（电机安装）

**操作步骤：**

1. 将 **HS 电机轴适配器** 插入每个电机的输出端
2. 将电机轴适配器**直接插入 HS 驱动轴**（或直接插入轮毂）
3. 用 **2 颗 0.500" 螺丝** 将电机固定在 C型铝材内侧

**齿轮啮合检查（齿轮传动方案）：**
- 用手转动轮子 — 应平顺、有轻微阻力、无咔嗒声或磨齿声
- 一张纸应刚好能插入啮合齿面之间（间隙测试）
- 中等负载下不打齿（握住轮子，施加力）

> **电机安装方向：** 两个电机**镜像对称**安装，输出轴都朝内（指向底盘中心）。这就是为什么 `main.cpp` 中 `RightDriveSmart` 构造函数使用 `true`（反转）。

### 4.4 第四步：安装支撑轮

**目标：** 在机器人前端或后端中心安装一个自由旋转的全向轮以保持平衡。

**本步骤所需零件：**
- 1× 2.75" 全向轮
- 1× 标准轴 2"
- 2× 标准平面轴承
- 2× 标准轴环
- 2× 尼龙垫片 1/8"

**操作步骤：**

1. **选择安装位置：** 前横梁或后横梁的中心（选择与驱动轮相对的一端效果最好）
2. 将 **2 个标准平面轴承** 压入横梁中心处的孔中
3. 滑入 **标准 2" 轴**：轴承 → 1/8" 垫片 → 2.75" 全向轮 → 1/8" 垫片 → 轴承
4. 用 **标准轴环** 在两侧锁定

**质量检查：** 支撑轮自由旋转。机器人在所有 3 个接地点上水平放置（2 驱动 + 1 支撑）。机器人不会向任何方向倾倒。

### 4.5 第五步：安装主控与电池

**目标：** 主控屏幕可视、USB 口可及；电池方便更换。

**本步骤所需零件：**
- 4× 铜柱（1" 或 2"）
- 8× 螺丝 8-32 × 0.500"（或 1.000" 穿铜柱用）
- 4× Nylock 螺母

**操作步骤：**

1. 用 0.500" 螺丝将 4 根**铜柱 (1")** 固定在底盘框架顶面，穿过铜柱拧入下方螺母
   - 位置：底盘中央偏前，对齐主控安装孔
   - 铜柱将主控抬高，线缆可从下方穿过
2. 将 **V5 主控** 放在铜柱顶部，对齐安装孔
3. 用 0.250" 螺丝穿过主控安装孔固定到铜柱顶部
   - 屏幕朝**上**，方便查看
   - USB-C 接口可从侧面**轻松接入**（不被金属遮挡）
4. 将 **V5 电池** 放在底盘底部或主控后方，取决于重心平衡
   - 用**扎带**或 VEX 橡皮筋绑在框架上
   - 将电池线缆插入主控的电池接口
   - 电池应方便取出以便比赛间隙充电

### 4.6 第六步：安装 IMU

**目标：** IMU 水平、居中、远离电机、牢固固定。

**本步骤所需零件：**
- 1× V5 惯性传感器
- 2× 螺丝 8-32 × 0.250"
- 2× Nylock 螺母
- （可选）1× 平板用于安装

**操作步骤：**

1. 在**底盘中心**找一块平坦区域 — 最好在横梁上或螺栓固定在侧梁之间的小平板上
2. 用 2 颗螺丝穿过 IMU 的安装孔，将其**水平**安装（与地面平行）
3. 传感器的箭头标记应指向**前方**（机器人前进方向）

**IMU 安装原则：**
- ✅ **水平放置** — 任何倾斜都会引入与 `sin(倾斜角)` 成正比的朝向误差
- ✅ **居中安装** — 最小化振动引起的测量噪声
- ✅ **牢固固定** — 松动安装 = 抖动读数，尤其在加减速时
- ❌ **不要靠近电机** — 电机永磁体干扰磁力计
- ❌ **不要悬空安装** — 必须从下方支撑，不能悬挂在无支撑的边缘
- ❌ **不要接触电池** — 电池电流产生磁场

### 4.7 第七步：接线与走线

**连接 V5 智能线缆：**

**2电机配置 (ROBOT_2MOTOR)：**

| 设备 | 主控端口 | 线缆长度 | 配置常量 |
|------|---------|---------|----------|
| 左驱动电机 | **端口 1** | 300mm | `LEFT_MOTOR_PORT = 1` |
| 惯性传感器 (IMU) | **端口 5** | 600mm | `IMU_PORT = 5` |
| 右驱动电机 | **端口 10** | 300mm | `RIGHT_MOTOR_PORT = 10` |

**6电机配置 (ROBOT_6MOTOR)：**

| 设备 | 主控端口 | 线缆长度 | 配置常量 |
|------|---------|---------|----------|
| 左前电机 | **端口 1** | 300mm | `LEFT_FRONT_PORT = 0`（端口索引 0） |
| 左中电机 | **端口 2** | 300mm | `LEFT_MID_PORT = 1` |
| 左后电机 | **端口 3** | 300mm | `LEFT_REAR_PORT = 2` |
| 右前电机 | **端口 4** | 300mm | `RIGHT_FRONT_PORT = 3` |
| 右中电机 | **端口 5** | 300mm | `RIGHT_MID_PORT = 4` |
| 右后电机 | **端口 6** | 300mm | `RIGHT_REAR_PORT = 5` |
| 惯性传感器 (IMU) | **端口 10** | 600mm | `IMU_PORT = 9`（端口索引 9） |

**走线规则：**

1. 线缆走线整齐 — 不要在轮子、齿轮或轴附近形成环状
2. 每 50-80mm 用**扎带**将线缆固定在框架上
3. 每个接头处留**松弛量**（应力释放）— 不要将线缆拉紧
4. 线缆**远离运动部件** — 与旋转轴及齿轮保持至少 10mm 的间隙
5. 多余线缆长度塞入主控下方或电池旁边
6. 反复检查：将每个接头推入直到咔嗒一声（接头未完全插入会导致间歇性故障）

> **如果你使用不同端口：** 更新 `include/config.h` 中对应配置的端口常量。

---

## 5. 软件配置

组装完成后，首先在 `include/config.h` 中选择你的机器人配置：

```cpp
// =====================================
//   选择你的机器人配置
// =====================================
// 取消注释以下其中一个：
#define ROBOT_2MOTOR    // 入门级：2电机，绿色齿轮箱
// #define ROBOT_6MOTOR // 进阶版：6电机，蓝色齿轮箱
```

然后验证物理常量与实际测量值匹配：

**ROBOT_2MOTOR 配置：**
```cpp
constexpr double WHEEL_DIAMETER   = 0.1016;   // 4" 全向轮 = 0.1016m
constexpr double WHEEL_TRACK      = 0.381;    // 请测量你的机器人！（米）
constexpr double TICKS_PER_REV    = 360.0;    // 绿色齿轮箱直驱

constexpr int LEFT_MOTOR_PORT  = 1;
constexpr int RIGHT_MOTOR_PORT = 10;
constexpr int IMU_PORT         = 5;
```

**ROBOT_6MOTOR 配置：**
```cpp
constexpr double WHEEL_DIAMETER   = 0.08255;  // 3.25" 全向轮 = 0.08255m
constexpr double WHEEL_TRACK      = 0.330;    // 请测量你的机器人！（米）
constexpr double TICKS_PER_REV    = 300.0;    // 蓝色齿轮箱直驱

constexpr int LEFT_FRONT_PORT  = 0;
constexpr int LEFT_MID_PORT    = 1;
constexpr int LEFT_REAR_PORT   = 2;
constexpr int RIGHT_FRONT_PORT = 3;
constexpr int RIGHT_MID_PORT   = 4;
constexpr int RIGHT_REAR_PORT  = 5;
constexpr int IMU_PORT         = 9;
constexpr int ENCODER_MOTOR_INDEX = 1;  // 中间电机用于里程计

// PID增强参数（仅6电机自动启用）
constexpr double DRIVE_INTEGRAL_LIMIT = 5.0;   // 防止直线行驶积分饱和
constexpr double DRIVE_D_FILTER       = 0.7;   // EMA平滑微分（alpha=0.7）
constexpr double TURN_INTEGRAL_LIMIT  = 3.0;   // 防止转弯积分饱和
constexpr double TURN_D_FILTER        = 0.5;   // EMA平滑微分（alpha=0.5）
constexpr double BOOMERANG_LEAD       = 0.6;   // 回旋镖前导点距离（米）
```

**同时验证 `src/main.cpp`：**

```cpp
// 2电机配置：
motor LeftDriveSmart  = motor(LEFT_MOTOR_PORT,  ratio18_1, false); // 绿色 = 18:1
motor RightDriveSmart = motor(RIGHT_MOTOR_PORT, ratio18_1, true);  // 反转

// 6电机配置：
motor LeftFront  = motor(LEFT_FRONT_PORT,  ratio6_1, true);   // 蓝色 = 6:1，左侧反转
motor LeftMid    = motor(LEFT_MID_PORT,    ratio6_1, true);
motor LeftRear   = motor(LEFT_REAR_PORT,   ratio6_1, true);
motor RightFront = motor(RIGHT_FRONT_PORT, ratio6_1, false);
motor RightMid   = motor(RIGHT_MID_PORT,   ratio6_1, false);
motor RightRear  = motor(RIGHT_REAR_PORT,  ratio6_1, false);
```

---

## 6. 部署到 VEX V5 主控

### 前提条件

- 已安装 **VEX VS Code 扩展**（或 VEXcode Pro V5）
- **V5 主控** 已开机并连接
- 项目构建成功（`make` 退出码为 0）

### 上传步骤

1. **连接** V5 主控：
   - **有线（推荐）：** USB-C 线从电脑 → 主控
   - **无线：** USB 线从电脑 → 遥控器 → （无线） → 主控

2. **构建** 项目：
   - 按 `Cmd+Shift+B`（Mac）或 `Ctrl+Shift+B`（Windows）
   - 或在终端运行：`make`
   - 等待 `BUILD SUCCESSFUL`

3. **上传** 到主控：
   - 点击 VEX 扩展工具栏的 **下载 ↓** 按钮
   - 或命令面板 → `VEX: Build and Download`
   - 主控屏幕显示上传进度条

4. **运行** 程序：
   - 在 V5 主控上：点击程序名 → **运行**
   - 或连接竞赛开关 / 场地控制器，进入自主+手动控制模式

---

## 7. 首次启动验证（6项检查）

上传后，按顺序进行以下检查。每项检查验证软件栈的一个层次。

### ✅ 检查 1：主控显示 "Ready."

**验证：** IMU 校准、`pre_auton()` 正常运行

- 开机 → 程序运行 → 屏幕在 ~3 秒内显示 **"Ready."**
- **失败？** IMU 未连接到端口 5，或线缆损坏

### ✅ 检查 2：电机方向

**验证：** HAL 电机层、正确接线、反转标志

1. **将机器人架空**（轮子离地 — 安全第一！）
2. 前推左摇杆 → 左轮向前转
3. 前推右摇杆 → 右轮向前转
4. **仅 6电机：** 验证每侧 3 个轮子以相同速度同步旋转

- **失败？** 在 `main.cpp` 中翻转该电机的 `true`↔`false`
- **6电机失败？** 检查左侧电机是否设置了 `reversed=true`，右侧是否为 `reversed=false`

### ✅ 检查 3：编码器计数

**验证：** 编码器脉冲、`TICKS_PER_REV`

1. 在 `main()` 循环中添加调试代码（在 `odometry_update()` 之后）：
   ```cpp
   Brain.Screen.clearLine(2); Brain.Screen.setCursor(2, 1);
   Brain.Screen.print("L:%.0f R:%.0f",
       get_left_encoder_ticks(), get_right_encoder_ticks());
   ```
2. 手动转动轮子一整圈：
   - **2电机（绿色）：** ~360（±5）每转脉冲数
   - **6电机（蓝色）：** ~300（±5）每转脉冲数 — 编码器读取中间电机 (`ENCODER_MOTOR_INDEX=1`)

### ✅ 检查 4：IMU 朝向

**验证：** IMU 读数、朝向方向

1. 添加调试：`Brain.Screen.print("IMU: %.2f rad", get_imu_heading_rad());`
2. 用手将机器人顺时针旋转 90° → 读数 ≈ 1.57

### ✅ 检查 5：里程计追踪

**验证：** 完整定位流水线

1. 添加调试：
   ```cpp
   Pose p = get_pose(); Brain.Screen.clearLine(4); Brain.Screen.setCursor(4, 1);
   Brain.Screen.print("x:%.2f y:%.2f t:%.2f", p.x, p.y, p.theta);
   ```
2. 用手推机器人前进 1 米 → x ≈ 1.00

### ✅ 检查 6：自主 L 形路径

**验证：** PID、运动规划、完整控制栈

1. 将机器人放在地面上，前方 1.5 米和左侧有足够空间
2. 运行自主模式 → 机器人走 L 形路径
3. **第一次运行时轻轻扶住机器人**，以防电机方向错误！

---

## 8. 故障排查

### 机械问题

| 症状 | 可能原因 | 修复方法 |
|------|---------|---------|
| 机器人走偏 | 轮子直径不同、摩擦不均 | 交换轮子、清理胎面、检查有无杂物 |
| 齿轮磨齿/打齿 | 啮合过紧或过松 | 松开电机螺丝、调整至 3 孔距、重新拧紧 |
| 轴晃动 | 缺少轴承、孔磨损 | 每个轴穿过的孔都加装平面轴承 |
| 机器人前后倾倒 | 重心偏移 | 重新调整电池位置（最重的部件） |
| 轮子转不动 | 垫片叠得太紧、轴打滑 | 松开轴环、增减薄垫片 |
| 行驶中咔嗒作响 | 螺丝/螺母松了 | 拧紧所有紧固件、换用 Nylock 螺母 |
| 框架弯曲变形 | 横向支撑不足 | 加装角码、可选 L 型加固件 |
| 轮子在轴上打滑 | 轴环未拧紧、孔磨损 | 拧紧轴环固定螺丝、更换磨损的轮子 |

### 电气问题

| 症状 | 可能原因 | 修复方法 |
|------|---------|---------|
| 主控显示 "No program" | 程序未上传 | 通过 VEX 扩展重新上传 |
| "Ready." 从未出现 | IMU 端口错误 / 线缆坏了 | 检查接线，换线缆/端口试试 |
| 电机不转 | 线缆未完全插入 | 重新插入直到咔嗒响，验证端口号 |
| 一个轮子反转 | 电机反转标志错误 | 在 main.cpp 中翻转 `true`↔`false` |
| 编码器读数 ~900 | 装了红色齿轮箱 | 设置 `TICKS_PER_REV=900`、`ratio36_1` |
| 上传失败 | 主控未正确连接 | USB-C 直连主控、重启主控 |
| 遥控器无响应 | 未配对 / 未充电 | 重新与主控配对、给遥控器充电 |

### 软件问题

| 症状 | 可能原因 | 修复方法 |
|------|---------|---------|
| 里程计漂移 | `WHEEL_DIAMETER` 或 `WHEEL_TRACK` 不准 | 用游标卡尺精确重新测量 |
| 转弯冲过头 | PID 增益太大 | 减小 `TURN_KP`、增大 `TURN_KD` |
| 直线行驶冲过目标 | `MAX_VELOCITY` 太高 | 在 config.h 中减小 `MAX_VELOCITY` || 回旋镖路径太宽/太窄 | `BOOMERANG_LEAD` 不合适 | 增大（更窄）或减小（更宽），当前 0.6 |
| PID积分延迟 | 积分饱和 | 检查 INTEGRAL_LIMIT 值（6电机已自动启用） || `make` 编译失败 | SDK 路径错误 | 确保 VEX 扩展已安装且 SDK 路径存在 |
| `make test` 失败 | 需要主机编译器 | Mac 上运行 `xcode-select --install` 安装 g++ |

---

## 9. 附录：零件编号速查表

### 2电机配置 (ROBOT_2MOTOR)

```
╔══════════════════════════════════════════════════════════════════════╗
║  VEX V5 2电机差速驱动 — 零件汇总                                      ║
╠══════════════════════════════════════════════════════════════════════╣
║  V5 智能电机（绿色齿轮箱）              276-4840       ×2             ║
║  V5 惯性传感器                         276-4855       ×1             ║
║  智能线缆 300mm                       276-4850       ×2             ║
║  智能线缆 600mm                       276-4851       ×1             ║
║  4" 全向轮                            276-3526       ×2             ║
║  HS 轴 4"                             276-2293       ×2             ║
║  HS 电机轴适配器                       276-8532       ×2             ║
║  2.75" 全向轮（支撑轮）                276-3525       ×1             ║
║  标准轴 2"                            276-2011       ×1             ║
╚══════════════════════════════════════════════════════════════════════╝
```

### 6电机配置 (ROBOT_6MOTOR)

```
╔══════════════════════════════════════════════════════════════════════╗
║  VEX V5 6电机差速驱动 — 零件汇总                                      ║
╠══════════════════════════════════════════════════════════════════════╣
║  V5 智能电机（蓝色齿轮箱）              276-4840       ×6             ║
║  V5 惯性传感器                         276-4855       ×1             ║
║  智能线缆 300mm                       276-4850       ×6             ║
║  智能线缆 600mm                       276-4851       ×1             ║
║  3.25" 全向轮                         276-3524       ×6             ║
║  HS 轴 4"                             276-2293       ×6             ║
║  HS 电机轴适配器                       276-8532       ×6             ║
║  HS 平面轴承                          276-2310       ×12            ║
║  HS 锁紧轴环                          276-2308       ×12            ║
║  （无需支撑轮 — 6个驱动轮提供稳定性）                                  ║
╚══════════════════════════════════════════════════════════════════════╝
```

> **通用零件（两种配置共用）：** V5 主控、V5 电池、V5 遥控器、V5 电池充电器、USB-C 线、C型铝材、横梁、角码、紧固件、垫片。详见物料清单第1节。

---

**硬件搭建与部署指南 — 完 —**
